<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>ðŸ“˜ Brainwave Dashboard</title>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
 <style>
  body {
    margin: 0;
    padding: 0;
    font-family: 'Poppins', sans-serif;
    background: #F5F7FA;
    transition: margin-left 0.4s ease-in-out;
  }

  /* Sidebar */
  .slider {
   width: 200px;
   height: 100vh;
   background-color: #2563EB;
   position: fixed;
   top: 0;
   left: 0;
   transform: translateX(-200px);
   transition: transform 0.4s ease-in-out;
   color: white;
   padding: 20px 10px;
   box-sizing: border-box;
   z-index: 998;
   display: flex;
   flex-direction: column;
  }

  /* Navbar */
  .navbar {
    background-color: #2563EB;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 20px;
    position: sticky;
    top: 0;
    z-index: 50;
  }

  .slidbtn {
   display: inline-block;
   z-index: 999;
  }

  .slidbtn button {
   width: 40px;
   height: 40px;
   background-color: rgb(15, 16, 17);
   color: white;
   border: none;
   cursor: pointer;
   font-size: 20px;
   border-radius: 5px;
   transition: background 0.2s;
  }

  .slidbtn button:hover {
   background-color: rgb(30, 30, 30);
  }

  .content {
   padding: 20px;
   transition: margin-left 0.4s ease-in-out;
  }

  body.open .slider {
    transform: translateX(0);
  }

  body.open .content {
    margin-left: 200px;
  }

  .menu button {
    display: block;
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border: none;
    border-radius: 8px;
    background: white;
    color: #007bff;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    text-align: left;
    transition: all 0.3s ease;
  }

  .menu button:hover {
    background: #0056b3;
    color: white;
    transform: translateX(5px);
  }

  .logout-btn {
    background: #111;
    color: white;
    padding: 10px 15px;
    border-radius: 6px;
    text-decoration: none;
    font-size: 16px;
    transition: background 0.3s ease;
  }

  .logout-btn:hover {
    background: #e63946;
  }

  /* Dashboard Cards */
  .grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .grid > div {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 1.5rem;
  }

  .grid h3 {
    color: #6b7280;
    font-size: 0.875rem;
  }

  .grid p {
    margin-top: 0.5rem;
  }

  .text-3xl {
    font-size: 1.875rem;
  }

  .text-indigo-600 { color: #4f46e5; }
  .text-orange-500 { color: #f97316; }
  .text-purple-500 { color: #a855f7; }
  .text-green-500 { color: #22c55e; }

  /* Upcoming Tasks */
  .upcoming-task {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .upcoming-task span {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
  }

  .bg-red-100 { background-color: #fee2e2; }
  .text-red-500 { color: #ef4444; }
  .bg-yellow-100 { background-color: #fef9c3; }
  .text-yellow-500 { color: #eab308; }

  main {
    padding: 2rem;
    margin-top: 1rem;
  }
 </style>
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="slidbtn">
      <button id="slider-btn" onclick="slidbar()">â˜°</button>
    </div>
    <h1>ðŸ“˜ Brainwave Dashboard</h1>
    <a href="/auth/logout" class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
  </nav>

  <!-- Sidebar -->
  <div class="slider" id="slider">
    <h2>Menu</h2>
    <div class="menu">
      <button onclick="location.href='/dashboard/'"><i class="fa-solid fa-chart-line"></i> Dashboard</button><br>
      <button onclick="location.href='/planner/'"><i class="fa-regular fa-calendar"></i> Planner</button><br>
      <button onclick="location.href='/chatbot/'"><i class="fa-regular fa-message"></i> Chatbot</button><br>
      <button onclick="location.href='/notes_summariser/summariser'"><i class="fa-solid fa-book"></i> Video to Notes</button><br>
      <button onclick="location.href='/quiz/'"><i class="fa-solid fa-medal"></i> Quizzes</button><br>
      <button onclick="location.href='/progress/'"><i class="fa-solid fa-arrow-trend-up"></i> Progress</button><br>
      <button onclick="location.href='/auth/logout'"><i class="fa-solid fa-right-from-bracket"></i> Logout</button><br>
    </div>
  </div>

  <!-- Dashboard Main -->
  <main class="content">
    <!-- Cards -->
    <div class="grid">
      <div>
        <h3>Today's Study Time</h3>
        <p id="study-time" class="text-3xl text-indigo-600">0m</p>
        <p class="text-xs text-gray-400 mt-1" id="study-change">+0% from yesterday</p>
      </div>
      <div>
        <h3>Study Streak</h3>
        <p id="study-streak" class="text-3xl text-orange-500">0 ðŸ”¥</p>
        <p class="text-xs text-gray-400 mt-1">Keep it going!</p>
      </div>
      <div>
        <h3>Quizzes Done</h3>
        <p id="quizzes-done" class="text-3xl text-purple-500">0</p>
        <p class="text-xs text-gray-400 mt-1">This week</p>
      </div>
      <div>
        <h3>Average Score</h3>
        <p id="average-score" class="text-3xl text-green-500">0%</p>
        <p class="text-xs text-gray-400 mt-1">All time</p>
      </div>
    </div>

    <!-- Chart and Upcoming -->
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
      <!-- Chart -->
      <div class="bg-white rounded-2xl shadow-md p-6">
        <h3 class="text-lg font-semibold mb-3 text-indigo-600">Weekly Study Progress</h3>
        <canvas id="studyChart"></canvas>
      </div>

      <!-- Upcoming -->
      <div class="bg-white rounded-2xl shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4 text-orange-500">Upcoming</h3>
        <ul class="space-y-3" id="upcoming-list"></ul>
        <button class="w-full mt-5 bg-gradient-to-r from-orange-400 to-red-500 text-white py-2 rounded-xl font-semibold hover:shadow-lg transition-all">View All â†’</button>
      </div>
    </div>
  </main>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // Sidebar toggle
    function slidbar() {
      document.body.classList.toggle("open");
      const sliderBtn = document.getElementById("slider-btn");
      sliderBtn.style.display = document.body.classList.contains("open") ? "none" : "inline-block";
    }

    document.addEventListener("DOMContentLoaded", function() {
      const menuHeading = document.querySelector(".slider h2");
      menuHeading.addEventListener("click", function() {
        document.body.classList.remove("open");
        document.getElementById("slider-btn").style.display = "inline-block";
      });
    });

    // Dynamic dashboard logic
    async function loadDashboardData() {
      try {
        const response = await fetch('/api/dashboard-data');
        const data = await response.json();

        // Update top cards
        document.getElementById("study-time").textContent = data.studyTimeToday + "m";
        document.getElementById("study-change").textContent = data.studyChange + "% from yesterday";
        document.getElementById("study-streak").textContent = data.studyStreak + " ðŸ”¥";
        document.getElementById("quizzes-done").textContent = data.quizzesDone;
        document.getElementById("average-score").textContent = data.averageScore + "%";

        // Update chart
        const ctx = document.getElementById('studyChart').getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
            datasets: [{
              label: 'Study Minutes',
              data: data.weeklyProgress,
              borderColor: '#6366f1',
              backgroundColor: 'rgba(99,102,241,0.1)',
              tension: 0.4,
              fill: true
            }]
          },
          options: {
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true }, x: { grid: { display: false } } }
          }
        });

        // Update upcoming
        const upcomingList = document.getElementById('upcoming-list');
        upcomingList.innerHTML = "";
        data.upcomingTasks.forEach(task => {
          const li = document.createElement('li');
          li.className = "upcoming-task";
          li.innerHTML = `
            <div>
              <p class="font-medium text-gray-700">${task.task}</p>
              <span class="text-xs text-gray-400">${task.date}</span>
            </div>
            <span class="bg-${task.priority === 'high' ? 'red' : 'yellow'}-100 text-${task.priority === 'high' ? 'red' : 'yellow'}-500">${task.priority}</span>
          `;
          upcomingList.appendChild(li);
        });

      } catch (err) {
        console.error('Error loading data:', err);
      }
    }

    document.addEventListener('DOMContentLoaded', loadDashboardData);
  </script>
</body>
</html>